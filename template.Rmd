---
title: "Super Awesome Project Template"
output: word_document
names: "Caleb Bekkum, Luke Spika, Cole Umland, Charlie Wiegel"
date: "2025-04-11"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Section One
Genius API info 
Client ID: r8BXdSiDmw9qfMoxh2S3f1g4AtvDaPf8XD-TWjkO77sc_hvsglOutM9Pl67I67Tr
Client Secret : pvEdzTUfKqtLbjv0qdxBJrqs5Hj1JQlhf4ICcQPWp3Zfo5j7uO88_34UWDbmT5a38wZP9lrTksDX4r8csgZsVA
Client Access Token: BoaVCPyQtW90wUPpm3lPVgm1b5AJGB0BIBvG1UO9dj473mlajOuyvJ1hrN0Dvw9G
Nickname : Luke5pika

```{r}

# This code chunk is for setting up access and web-scraping song info from the Spotify API

library(httr)
library(jsonlite)
library(rvest)

# Genius API Token
genius_token <- "BoaVCPyQtW90wUPpm3lPVgm1b5AJGB0BIBvG1UO9dj473mlajOuyvJ1hrN0Dvw9G" 
# Test song
test_title <- "Blinding Lights"
test_artist <- "The Weeknd"

# Function to search Genius for lyrics of given songs
# inputs: title of song, artist of song, and a given Genius token
# outputs: A url to the Genius page containing the lyrics of the song, as well as the lyrics themselves
search_song <- function(title, artist, token) {
  query <- URLencode(paste(title, artist))
  url <- paste0("https://api.genius.com/search?q=", query)
  res <- GET(url, add_headers(Authorization = paste("Bearer", token)))

  if (status_code(res) == 200) {
    json <- fromJSON(content(res, as = "text"), simplifyVector = FALSE)
    hits <- json$response$hits

    for (hit in hits) {
      result <- hit[["result"]]
      if (!is.null(result)) {
        primary_artist <- result[["primary_artist"]]
        artist_name <- primary_artist[["name"]]

        if (!is.null(artist_name) && grepl(tolower(artist), tolower(artist_name))) {
          return(result[["url"]])
        }
      }
    }
  } else {
    warning("API request failed with status code: ", status_code(res))
  }

  return(NA)
}

# Function to get lyrics
get_lyrics <- function(url) {
  page <- read_html(url)
  lyrics_nodes <- html_elements(page, '[data-lyrics-container="true"]')
  
  if (length(lyrics_nodes) == 0) {
    lyrics_nodes <- html_elements(page, 'div.lyrics')
  }
  
  lyrics <- lyrics_nodes %>% 
    html_text(trim = TRUE) %>% 
    paste(collapse = "\n")
  
  return(lyrics)
}

# Run test
song_url <- search_song(test_title, test_artist, genius_token)
cat("Genius URL:", song_url, "\n")

if (!is.na(song_url)) {
  lyrics <- get_lyrics(song_url)
  cat(substr(lyrics, 1, 500))  # Print first 500 chars
} else {
  cat("No Genius URL found.\n")
}
```

## Section Two

```{r Luke Spika}
new project test
```

## Section Three

```{r Cole Umland}
#This table is cleaned up and ready to roll.
library(rvest)
library(dplyr)
library(purrr)
library(stringr)

decade_urls <- c(
  "https://en.wikipedia.org/wiki/List_of_Billboard_Hot_100_number-one_singles_from_1958_to_1969",
  "https://en.wikipedia.org/wiki/List_of_Billboard_Hot_100_number-one_singles_of_the_1970s",
  "https://en.wikipedia.org/wiki/List_of_Billboard_Hot_100_number-one_singles_of_the_1980s",
  "https://en.wikipedia.org/wiki/List_of_Billboard_Hot_100_number-one_singles_of_the_1990s",
  "https://en.wikipedia.org/wiki/List_of_Billboard_Hot_100_number-one_singles_of_the_2000s",
  "https://en.wikipedia.org/wiki/List_of_Billboard_Hot_100_number-one_singles_of_the_2010s",
  "https://en.wikipedia.org/wiki/List_of_Billboard_Hot_100_number-one_singles_of_the_2020s"
)

all_number_ones <- map_df(decade_urls, function(url) {
  page <- read_html(url)

  table <- page %>%
    html_node("table.wikitable") %>%
    html_table(fill = TRUE)

  names(table) <- tolower(names(table))

  if (any(str_detect(names(table), "single|song")) && any(str_detect(names(table), "artist"))) {
    cleaned <- table %>%
      select(contains("single"), contains("artist"), contains("reached")) %>%
      rename_with(~ c("single", "artist", "date")[1:length(.)]) %>%
      # Remove rows with all values that have four characters
      #Clever, ran into the problem where deleting rows with only four characters also deleted songs with years titles (ex: "1999"). Fixed this by changing any to all in the following code line. All rows with years in every column are now deleted
      filter(!apply(., 1, function(row) all(nchar(as.character(row)) == 4)))
    return(cleaned)
  } else {
    return(NULL)
  }
})

```

## Section Four 

```{r Charlie Wiegel}

```
